<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Graph Example with Sidebar</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .hyperlink{
            justify-content: left;
            padding-right: 50px;
            font-weight: bold;
        }

        .sidebar {
            height: 100%;
            width: 250px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            background-color: #f8f9fa;
            padding-top: 20px;
        }

        .sidebar a {
            padding: 10px;
            text-decoration: none;
            font-size: 18px;
            color: #000000;
            display: block;
        }

        .sidebar a:hover {
            background-color: #ffffff;
        }

        /* 추가된 스타일 */
        .input-container {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        /* 추가된 스타일 */
        .btn-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="logo-container form-group row justify-content-between center-align">
    <div class ="logo">
    </div>
    <div>
        <a th:href="@{/logout}" class="hyperlink">로그아웃</a>
    </div>
</div>
<div class="container-fluid mt-5">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-2">
            <div class="sidebar" style="position: fixed; height: 100%; width: 200px; background-color: #f8f9fa; padding-top: 20px;">
                <a href="#" onclick="updateGraph()">Category 1</a>
                <a href="#" onclick="updateGraph()">Category 2</a>
                <a href="#" onclick="updateGraph()">Category 3</a>
                <a href="#" onclick="updateGraph()">Category 4</a>
                <a href="/graph" onclick="updateGraph()">Category 5</a>
            </div>
        </div>
        <!-- Graph -->
        <div class="col-10">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <canvas id="myChart" style="width: 60%; height: 100%;"></canvas>
                    <!-- 추가된 입력 필드와 버튼 -->
                    <div class="input-container">
                        <input type="text" id="inputValue" class="form-control" placeholder="값을 입력하세요">
                    </div>
                    <div class="btn-container">
                        <button id="updateButton" class="btn btn-primary btn-block" onclick="sendData()">업데이트</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script>
    var categoryData = {
        "Category 1": [10, 20, 30, 40, 50],
        "Category 2": [20, 30, 40, 50, 60],
        "Category 3": [30, 40, 50, 60, 70],
        "Category 4": [40, 50, 60, 70, 80],
        "Category 5": [50, 60, 70, 80, 90]
    };

    var initialData = categoryData["Category 1"];

    var data = {
        labels: ["Red", "Blue", "Yellow", "Green", "Purple"],
        datasets: [{
            label: 'Example Data',
            data: initialData,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                //'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                //'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    };

    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
            title: {
                display: true,
                text: 'My Chart Title',
                fontSize: 20,
                fontColor: 'blue'
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            barThickness: 30,
        }
    });

    function updateGraph() {
        //var newData = initialData;
        //myChart.data.datasets[0].data = newData;
        myChart.update();
    }

    function sendData() {
        var value = document.getElementById("inputValue").value;
        $.ajax({
            url: "/updateGraph",
            method: "POST",
            data: { value: value },
            success: function(response) {
                updateGraph();
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }
</script>
</body>
</html>